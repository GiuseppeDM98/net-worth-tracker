# Dividend Tracking - Implementation Prompts Guide

> **Purpose**: This document contains ready-to-use prompts for implementing the dividend tracking feature incrementally across 4 sessions.
>
> **Reference Plan**: `.claude/plans/cached-rolling-llama.md`
>
> **Total Effort**: 7-11 hours across 3-4 days

---

## üìã Implementation Overview

The feature is divided into 4 sequential sessions:

1. **Session 1**: Foundation (Data Models + Services) - 2-3 hours
2. **Session 2**: API Layer (Routes + Cron) - 1-2 hours
3. **Session 3**: UI Components (Dialog, Table, Stats) - 3-4 hours
4. **Session 4**: Integration & Testing - 1-2 hours

Each session builds on the previous one and delivers a testable unit.

---

## üîß Session 1: Foundation (Data + Services)

### Prompt

```
I want to implement the FOUNDATION layer for dividend tracking feature.

Reference: .claude/plans/cached-rolling-llama.md - Phase 1 & 2

Tasks for this session:
1. Create /types/dividend.ts with all interfaces (Dividend, DividendFormData, DividendStats, ScrapedDividend, DividendType)
2. Modify /types/assets.ts:
   - Add optional `isin?: string` field to Asset and AssetFormData interfaces
   - Add `dividendIncomeCategoryId?: string` and `dividendIncomeSubCategoryId?: string` to AssetAllocationSettings
3. Update /firestore.rules:
   - Add security rules for `dividends` collection (after expenseCategories section ~line 116)
   - Rules: read/create/update/delete with userId validation
4. Update /firestore.indexes.json:
   - Add 3 composite indexes for dividends queries:
     - (userId, paymentDate DESC)
     - (userId, assetId, paymentDate DESC)
     - (userId, isin) for assets
5. Install web scraping dependency:
   - Run: npm install jsdom @types/jsdom
6. Implement /lib/services/dividendService.ts:
   - getAllDividends(userId)
   - getDividendsByAsset(userId, assetId)
   - getDividendsByDateRange(userId, startDate, endDate)
   - getDividendById(dividendId)
   - createDividend(userId, dividendData, assetTicker, assetName, assetIsin?, isAutoGenerated)
   - updateDividend(dividendId, updates)
   - deleteDividend(dividendId)
   - calculateDividendStats(userId, startDate?, endDate?)
   - getDividendsByAssetGrouped(userId)
   - getUpcomingDividends(userId)
   - isDuplicateDividend(userId, assetId, exDate)
7. Implement /lib/services/borsaItalianaScraperService.ts:
   - scrapeDividendsByIsin(isin: string): Promise<ScrapedDividend[]>
   - Parse HTML from: https://www.borsaitaliana.it/borsa/quotazioni/azioni/elenco-completo-dividendi.html?isin={ISIN}&lang=it
   - Extract: ex-date, payment date, dividend per share, currency, type
   - calculateWithholdingTax(grossAmount, taxRate=26)
8. Implement /lib/services/dividendIncomeService.ts:
   - createExpenseFromDividend(dividend, categoryId, subCategoryId?)
   - updateExpenseFromDividend(dividend, expenseId)
   - deleteExpenseForDividend(dividendId, expenseId)
   - syncDividendExpenses(userId, dividends, categoryId, subCategoryId?)

Follow patterns from:
- /lib/services/expenseService.ts (CRUD structure, Firestore queries)
- /lib/services/assetService.ts (removeUndefinedFields helper, denormalization)

Key requirements:
- Use removeUndefinedFields() helper for clean Firestore writes
- Convert Date ‚Üî Timestamp in all get/create/update operations
- Default sort order: paymentDate DESC
- Denormalize assetTicker/assetName for efficient queries
- Auto-calculate netAmount and totals (totalGross, totalTax, totalNet)
- Italian date parsing (DD/MM/YYYY) in scraper
- Try/catch error handling in scraper (return empty array on failure)

After implementation:
1. I'll deploy Firestore changes: firebase deploy --only firestore
2. We can test services via Node.js console or simple test script
3. Verify ISIN scraping with test ticker: IT0003128367 (ENEL)

Start with types, then Firestore config, then services in order.
```

### Deliverables ‚úÖ

- [x] 3 new files: dividend.ts, dividendService.ts, borsaItalianaScraperService.ts, dividendIncomeService.ts
- [x] 3 modified files: assets.ts, firestore.rules, firestore.indexes.json
- [x] Dependency installed: jsdom
- [x] Backend layer complete and testable

### Testing Commands

```bash
# Deploy Firestore
firebase deploy --only firestore:rules
firebase deploy --only firestore:indexes

# Wait 5-10 minutes for indexes to build

# Test scraping (Node.js console or test file)
node -e "
const { scrapeDividendsByIsin } = require('./lib/services/borsaItalianaScraperService');
scrapeDividendsByIsin('IT0003128367').then(console.log);
"
```

---

## üåê Session 2: API Layer

### Prompt

```
I want to implement the API ROUTES for dividend tracking feature.

Reference: .claude/plans/cached-rolling-llama.md - Phase 3

Prerequisites: Foundation layer completed (Session 1) ‚úÖ

Tasks for this session:
1. Create /app/api/dividends/route.ts:
   - GET endpoint with query params: userId, assetId?, startDate?, endDate?
     - If assetId: call getDividendsByAsset()
     - If startDate+endDate: call getDividendsByDateRange()
     - Otherwise: call getAllDividends()
   - POST endpoint to create manual dividend:
     - Validate body: { userId, dividendData }
     - Fetch asset via getAssetById() to get ticker/name/isin
     - Call createDividend()
     - If paymentDate <= today && settings.dividendIncomeCategoryId exists:
       - Call createExpenseFromDividend()
     - Return { id: dividendId }

2. Create /app/api/dividends/[dividendId]/route.ts:
   - PUT endpoint to update dividend:
     - Call updateDividend()
     - If linkedExpenseId exists: call updateExpenseFromDividend()
   - DELETE endpoint to delete dividend:
     - Get dividend to check linkedExpenseId
     - If exists: call deleteExpenseForDividend()
     - Call deleteDividend()

3. Create /app/api/dividends/scrape/route.ts:
   - POST endpoint: { userId, assetId }
   - Fetch asset and verify ISIN exists
   - Call scrapeDividendsByIsin()
   - Filter duplicates using isDuplicateDividend()
   - Create dividend records with isAutoGenerated=true
   - For paid dividends (paymentDate <= today):
     - Get user settings via getSettings()
     - If dividendIncomeCategoryId configured: createExpenseFromDividend()
   - Return: { scraped, created, skipped }

4. Create /app/api/dividends/stats/route.ts:
   - GET endpoint: userId, startDate?, endDate?
   - Call calculateDividendStats()
   - Return stats object

5. Create /app/api/cron/daily-dividend-processing/route.ts:
   - GET endpoint for Vercel cron (runs daily at 00:00 UTC)
   - Verify CRON_SECRET in Authorization header
   - Query all users from Firestore
   - For each user:
     - Get user settings (dividendIncomeCategoryId)
     - If configured, query dividends with:
       - paymentDate = today (00:00 to 23:59)
       - linkedExpenseId = null
     - Call createExpenseFromDividend() for each
   - Return: { processedCount, errorCount, timestamp }

6. Update /vercel.json:
   - Add cron job configuration:
     {
       "crons": [
         {
           "path": "/api/cron/daily-dividend-processing",
           "schedule": "0 0 * * *"
         }
       ]
     }

Follow patterns from:
- /app/api/expenses/route.ts (request validation, error handling)
- /app/api/cron/monthly-snapshot/route.ts (cron authentication)

Key requirements:
- Validate all inputs (userId, assetId, dates)
- Use try/catch with proper error responses
- Return NextResponse.json() with appropriate status codes
- CRON_SECRET authentication for cron endpoint
- Use Firebase Admin SDK in cron (not client SDK)

After implementation, help me test endpoints:
1. POST /api/dividends - create manual dividend
2. GET /api/dividends?userId=XXX - fetch all
3. POST /api/dividends/scrape - scrape ENEL (IT0003128367)
4. GET /api/dividends/stats?userId=XXX - get statistics
5. Verify cron job scheduled in Vercel dashboard

I'll provide test curl commands or use Postman.
```

### Deliverables ‚úÖ

- [x] 5 new API route files
- [x] 1 modified file: vercel.json
- [x] Complete REST API for dividend operations
- [x] Cron job configured

### Testing Commands

```bash
# Test create manual dividend
curl -X POST http://localhost:3000/api/dividends \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "YOUR_USER_ID",
    "dividendData": {
      "assetId": "ASSET_ID",
      "grossAmount": 0.25,
      "withholdingTax": 0.065,
      "sharesHeld": 100,
      "exDate": "2024-01-15",
      "paymentDate": "2024-02-01",
      "dividendType": "ordinario",
      "currency": "EUR"
    }
  }'

# Test get all dividends
curl http://localhost:3000/api/dividends?userId=YOUR_USER_ID

# Test scraping
curl -X POST http://localhost:3000/api/dividends/scrape \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "YOUR_USER_ID",
    "assetId": "ASSET_ID_WITH_ISIN"
  }'

# Test stats
curl http://localhost:3000/api/dividends/stats?userId=YOUR_USER_ID
```

---

## üé® Session 3: UI Components

### Prompt

```
I want to implement the UI COMPONENTS for dividend tracking.

Reference: .claude/plans/cached-rolling-llama.md - Phase 4

Prerequisites: Foundation + API layers completed (Sessions 1-2) ‚úÖ

Tasks for this session:
1. Create /components/dividends/DividendDialog.tsx:
   - Form fields:
     - Asset selector (searchable combobox from user assets)
     - Gross amount per share (number input)
     - Withholding tax (number input, auto-calculated but editable)
     - Shares held (number input, pre-filled from asset.quantity)
     - Ex-date (date picker with Italian locale)
     - Payment date (date picker with Italian locale)
     - Dividend type (select: ordinario/straordinario/interim/finale)
     - Currency (select, default EUR)
     - Notes (optional textarea)
     - Source URL (optional input)
   - Calculated fields (read-only):
     - Net amount per share = gross - tax
     - Total gross = grossAmount √ó shares
     - Total tax = withholdingTax √ó shares
     - Total net = netAmount √ó shares
   - Zod validation schema:
     - All required fields validated
     - Refine: exDate < paymentDate
   - UX logic:
     - When grossAmount changes: auto-calculate withholdingTax = grossAmount √ó 0.26
     - Keep withholdingTax editable (for foreign dividends, special tax regimes)
     - When asset selected: pre-fill sharesHeld from asset.quantity
   - Create/Edit modes supported
   - API calls: POST /api/dividends (create), PUT /api/dividends/[id] (update)

2. Create /components/dividends/DividendTable.tsx:
   - Columns:
     - Asset (Ticker + Name)
     - Ex-date (DD/MM/YYYY format)
     - Payment date (DD/MM/YYYY)
     - Gross/share (‚Ç¨X.XXXX)
     - Tax/share (‚Ç¨X.XXXX)
     - Net/share (‚Ç¨X.XXXX)
     - Shares (#)
     - Total Net (‚Ç¨X,XXX.XX)
     - Yield % (if available)
     - Type (badge with color)
     - Actions (Edit, Delete buttons)
   - Features:
     - Tanstack Table for sorting/filtering
     - Pagination (50 rows per page)
     - Color-coded rows by dividend type
     - Sortable columns
     - Responsive design (collapse on mobile)
   - Actions:
     - Edit: open DividendDialog with selected dividend
     - Delete: confirm dialog, then DELETE /api/dividends/[id]

3. Create /components/dividends/DividendStats.tsx:
   - 4 metric cards:
     1. Total Dividends Received (period + all-time)
     2. Total Taxes Paid (period + all-time)
     3. Average Yield (weighted)
     4. Upcoming Dividends (announced but not paid)
   - Charts (using Recharts):
     1. Pie chart: Dividends by Asset
     2. Bar chart: Dividends by Year
     3. Line chart: Monthly Dividend Income
     4. Horizontal bar: Yield on Cost by Asset (if data available)
   - Period filter integration (startDate, endDate props)
   - Fetch data from: GET /api/dividends/stats

4. Create /components/dividends/DividendTrackingTab.tsx:
   - Layout structure:
     - Action buttons row:
       - "Aggiungi Dividendo" (opens DividendDialog)
       - "Scarica Tutti (Borsa Italiana)" (scrape all assets with ISIN)
       - "Esporta CSV" (export dividends to CSV)
     - DividendStats component
     - Filters row:
       - Asset filter (select)
       - Date range picker
       - Type filter (select)
     - DividendTable component
     - DividendDialog (controlled by state)
   - State management:
     - dividends (from GET /api/dividends)
     - stats (from GET /api/dividends/stats)
     - filters (asset, dateRange, type)
     - dialogOpen, selectedDividend (for edit)
   - Handlers:
     - handleScrapeAll: loop through assets with ISIN, call POST /api/dividends/scrape
     - handleExport: generate CSV using date-fns format, download
     - handleCreate/Edit/Delete: CRUD operations with toast notifications
   - useEffect: fetch dividends + stats on mount and when filters change

Follow patterns from:
- /components/expenses/ExpenseDialog.tsx (form structure, validation, asset selector)
- /components/expenses/ExpenseTable.tsx (Tanstack Table setup)
- /components/fire-simulations/FireCalculatorTab.tsx (stats cards, Recharts)

Key requirements:
- Use Italian locale from date-fns for all dates
- shadcn/ui components (Button, Dialog, Input, Select, Label, etc.)
- Zod + react-hook-form for form validation
- Toast notifications (sonner) for success/error
- Responsive design (Tailwind CSS)
- Accessibility (ARIA labels, keyboard navigation)
- Loading states during API calls
- Error handling with user-friendly messages

After implementation:
1. Test components in isolation (create test page if needed)
2. Verify form validation edge cases
3. Test table sorting/filtering
4. Check responsive behavior
5. Verify CSV export format

Let me know when you need clarification on any component.
```

### Deliverables ‚úÖ

- [x] 4 new component files
- [x] Complete UI layer with forms, tables, charts
- [x] Italian locale integration
- [x] CSV export functionality

### Testing Checklist

- [ ] DividendDialog opens and closes correctly
- [ ] Form validation works (required fields, date comparison)
- [ ] Auto-calculation of withholding tax (26% default)
- [ ] Manual override of tax field works
- [ ] Asset selector populates from user assets
- [ ] Shares pre-filled from selected asset
- [ ] Date pickers use Italian format (DD/MM/YYYY)
- [ ] Create dividend API call succeeds
- [ ] Edit dividend loads data and updates
- [ ] Delete dividend shows confirmation
- [ ] Table displays all columns correctly
- [ ] Table sorting works on all columns
- [ ] Pagination works (50 rows per page)
- [ ] Stats cards show correct values
- [ ] Charts render with real data
- [ ] Filters update table and stats
- [ ] Scrape All button processes multiple assets
- [ ] CSV export downloads valid file
- [ ] Responsive design works on mobile
- [ ] Loading states display during API calls
- [ ] Error messages show on failures

---

## üîó Session 4: Integration & Testing

### Prompt

```
I want to complete the INTEGRATION of dividend tracking feature and perform end-to-end testing.

Reference: .claude/plans/cached-rolling-llama.md - Phase 5

Prerequisites: All previous sessions completed (Sessions 1-3) ‚úÖ

Tasks for this session:
1. Modify /components/assets/AssetDialog.tsx:
   - Add ISIN field after ticker field (~line 50):
     - Label: "ISIN (per dividendi automatici)"
     - Input: placeholder "IT0003128367"
     - Disabled if: type !== 'stock' OR assetClass !== 'equity'
     - Help text: "Necessario solo per azioni italiane su Borsa Italiana"
   - Update Zod schema:
     - isin: z.string().regex(/^[A-Z]{2}[A-Z0-9]{9}[0-9]$/, 'ISIN non valido').optional().or(z.literal(''))
   - Ensure form submit includes isin in payload

2. Modify /app/dashboard/settings/page.tsx:
   - Add new section "Impostazioni Dividendi" after existing settings (border-top, pt-6):
     - h3: "Impostazioni Dividendi"
     - Description: "Configura la categoria per le entrate automatiche da dividendi"
     - Select: "Categoria Entrate Dividendi"
       - Options: only income categories (type='income')
       - Value: settings.dividendIncomeCategoryId
       - OnChange: update user settings in Firestore
     - Select: "Sottocategoria (opzionale)"
       - Disabled if no category selected
       - Options: subCategories of selected category
       - Value: settings.dividendIncomeSubCategoryId
     - Button: "Sincronizza Dividendi Esistenti"
       - OnClick: call syncDividendExpenses() from dividendIncomeService
       - Show toast with result: { created, updated, errors }
   - Fetch settings on mount
   - Update settings on change

3. Modify /app/dashboard/cashflow/page.tsx:
   - Change TabsList grid from `grid-cols-3` to `grid-cols-4`
   - Add new TabsTrigger:
     - value: "dividends"
     - Icon: Coins (from lucide-react)
     - Label: "Dividendi"
   - Add new TabsContent:
     - value: "dividends"
     - Content: <DividendTrackingTab />
   - Import DividendTrackingTab component

After integration, perform END-TO-END testing:

Test Flow 1: Manual Dividend Entry
1. Navigate to Cashflow ‚Üí Dividendi tab
2. Click "Aggiungi Dividendo"
3. Select asset, enter dividend data
4. Verify auto-calculation of tax (26%)
5. Override tax to 20% (test editability)
6. Submit form
7. Verify dividend appears in table
8. Check that expense was created in Tracciamento tab (if payment date <= today)
9. Verify expense amount = net dividend amount

Test Flow 2: Automatic Scraping
1. Navigate to Assets
2. Edit an Italian stock (e.g., ENEL)
3. Add ISIN: IT0003128367
4. Save asset
5. Navigate to Settings
6. Configure dividend income category (select "Entrate da investimenti" or similar)
7. Save settings
8. Navigate to Cashflow ‚Üí Dividendi
9. Click "Scarica Tutti (Borsa Italiana)"
10. Wait for scraping to complete
11. Verify dividends appear in table
12. Check that past dividends created expense entries
13. Verify future dividends are shown in "Dividendi Futuri" stats

Test Flow 3: Statistics & Filtering
1. Navigate to Dividendi tab
2. Verify stats cards show correct totals
3. Test asset filter (select one asset)
4. Verify table and stats update
5. Test date range filter
6. Verify filtering works correctly
7. Test type filter
8. Clear filters and verify all data returns

Test Flow 4: Edit & Delete
1. Click Edit on a dividend
2. Modify amount
3. Save
4. Verify linked expense updated (check Tracciamento tab)
5. Click Delete on a dividend
6. Confirm deletion
7. Verify dividend removed from table
8. Verify linked expense deleted

Test Flow 5: CSV Export
1. Click "Esporta CSV"
2. Verify file downloads
3. Open in Excel/Google Sheets
4. Verify all columns present and formatted correctly

Test Flow 6: Cron Job (Production)
1. Deploy to Vercel
2. Verify cron job appears in Vercel dashboard
3. Check cron schedule: 0 0 * * * (daily midnight UTC)
4. Wait for next execution or trigger manually
5. Check logs for success
6. Verify dividends paid today got expense entries created

Edge Cases to Test:
1. Asset deletion with existing dividends (should show error)
2. Changing dividend income category (sync button should work)
3. Dividends with future payment date (no expense created)
4. Duplicate dividend detection (scraping same ISIN twice)
5. Scraping failure (invalid ISIN, network error)
6. Currency non-EUR dividend entry
7. Dividend with 0% tax (edge case)

Bug Fixes & Polish:
- Fix any console errors
- Verify loading states
- Check mobile responsive
- Test keyboard navigation
- Verify ARIA labels
- Check Italian translations
- Optimize Firestore queries if needed
- Add missing error boundaries

Deployment:
1. Deploy Firestore rules: firebase deploy --only firestore:rules
2. Deploy Firestore indexes: firebase deploy --only firestore:indexes
3. Wait for indexes to build (5-10 minutes)
4. Commit code: git add . && git commit -m "feat: Add dividend tracking with Borsa Italiana scraping"
5. Push to main: git push origin main
6. Verify Vercel auto-deploy
7. Check production: test all flows in production environment
8. Monitor logs for 24 hours

Documentation:
- Update README.md with dividend tracking feature
- Add screenshots to docs/ folder (optional)
- Document ISIN field and Borsa Italiana integration
- Document dividend income category configuration

After all testing passes, the feature is complete! üéâ
```

### Deliverables ‚úÖ

- [x] 3 modified files for integration
- [x] Complete end-to-end testing
- [x] Production deployment
- [x] Feature fully operational

### Final Checklist

**Integration**
- [ ] ISIN field in AssetDialog
- [ ] Dividend settings in Settings page
- [ ] Dividendi tab in Cashflow page

**Testing (All Flows)**
- [ ] Manual dividend entry
- [ ] Automatic scraping
- [ ] Statistics & filtering
- [ ] Edit & delete operations
- [ ] CSV export
- [ ] Cron job execution
- [ ] Edge cases handled
- [ ] Bug fixes applied

**Deployment**
- [ ] Firestore rules deployed
- [ ] Firestore indexes built
- [ ] Code committed and pushed
- [ ] Vercel deployment successful
- [ ] Production testing complete
- [ ] Cron job verified in Vercel dashboard

**Documentation**
- [ ] README updated
- [ ] Feature documented
- [ ] Configuration steps documented

---

## üìä Progress Tracking Template

Copy this to track your progress:

```markdown
## Dividend Tracking Implementation Progress

### Session 1: Foundation ‚¨ú
- [ ] Types created
- [ ] Assets types modified
- [ ] Firestore rules updated
- [ ] Firestore indexes updated
- [ ] jsdom installed
- [ ] dividendService implemented
- [ ] borsaItalianaScraperService implemented
- [ ] dividendIncomeService implemented
- [ ] Firestore deployed
- [ ] Services tested

**Status**: Not Started | In Progress | Completed
**Date**: YYYY-MM-DD
**Notes**:

---

### Session 2: API Layer ‚¨ú
- [ ] /api/dividends route created
- [ ] /api/dividends/[id] route created
- [ ] /api/dividends/scrape route created
- [ ] /api/dividends/stats route created
- [ ] /api/cron/daily-dividend-processing created
- [ ] vercel.json updated
- [ ] API endpoints tested with curl/Postman

**Status**: Not Started | In Progress | Completed
**Date**: YYYY-MM-DD
**Notes**:

---

### Session 3: UI Components ‚¨ú
- [ ] DividendDialog created
- [ ] DividendTable created
- [ ] DividendStats created
- [ ] DividendTrackingTab created
- [ ] Components tested in isolation
- [ ] Validation working
- [ ] Charts rendering
- [ ] CSV export working

**Status**: Not Started | In Progress | Completed
**Date**: YYYY-MM-DD
**Notes**:

---

### Session 4: Integration & Testing ‚¨ú
- [ ] AssetDialog modified (ISIN field)
- [ ] Settings page modified (dividend settings)
- [ ] Cashflow page modified (Dividendi tab)
- [ ] Manual dividend entry tested
- [ ] Automatic scraping tested
- [ ] Statistics & filtering tested
- [ ] Edit & delete tested
- [ ] CSV export tested
- [ ] Edge cases tested
- [ ] Deployed to production
- [ ] Cron job verified

**Status**: Not Started | In Progress | Completed
**Date**: YYYY-MM-DD
**Notes**:

---

### Overall Status: ‚¨ú Not Started | üîÑ In Progress | ‚úÖ Completed
**Total Time Spent**: X hours
**Issues Encountered**:
**Lessons Learned**:
```

---

## üÜò Troubleshooting Guide

### Common Issues & Solutions

**Issue**: Firestore indexes not built
- **Solution**: Wait 5-10 minutes after deploying indexes. Check Firebase Console ‚Üí Firestore ‚Üí Indexes

**Issue**: Scraping returns empty array
- **Solution**: Check Borsa Italiana HTML structure hasn't changed. Verify ISIN format. Test with known ticker (IT0003128367)

**Issue**: Cron job not running
- **Solution**: Verify CRON_SECRET env variable in Vercel. Check cron schedule format. View logs in Vercel dashboard

**Issue**: Dividend creates duplicate expense
- **Solution**: Check linkedExpenseId is being set correctly. Verify duplicate detection logic

**Issue**: Stats showing incorrect values
- **Solution**: Check date filtering in calculateDividendStats(). Verify totals calculation includes correct dividends

**Issue**: Table not updating after create/edit
- **Solution**: Ensure state is being refreshed. Check API response. Verify useEffect dependencies

---

## üí° Tips & Best Practices

1. **Test incrementally**: After each session, test thoroughly before moving to next
2. **Use git branches**: Create feature branch, commit frequently, squash before merge
3. **Monitor Firestore costs**: Check usage in Firebase Console after testing
4. **Keep plan.md open**: Reference detailed specs while coding
5. **Ask for help**: If stuck, provide context: session number, specific task, error message
6. **Document changes**: Add comments explaining complex logic (especially scraping)
7. **Performance**: Use Firestore indexes, limit query results, optimize re-renders
8. **Security**: Validate all inputs server-side, enforce Firestore rules, sanitize scraped data

---

## üìö Reference Files

**Patterns to Follow**:
- `/lib/services/expenseService.ts` - CRUD operations
- `/lib/services/assetService.ts` - Helper functions
- `/components/expenses/ExpenseDialog.tsx` - Form structure
- `/components/expenses/ExpenseTable.tsx` - Table implementation
- `/components/fire-simulations/FireCalculatorTab.tsx` - Stats layout

**Key Dependencies**:
- jsdom - HTML parsing for scraping
- date-fns - Date formatting with Italian locale
- Tanstack Table - Advanced table features
- Recharts - Data visualization
- Zod - Schema validation
- react-hook-form - Form management

---

**Last Updated**: 2025-01-08
**Plan Reference**: `.claude/plans/cached-rolling-llama.md`
**Feature Status**: Ready for Implementation

---

Good luck with the implementation! üöÄ
